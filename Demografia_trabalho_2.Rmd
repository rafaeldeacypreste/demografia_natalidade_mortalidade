---
title: "TRABALHO 1 - Estrutura populacional e projeções"
subtitle: "Demografia 1.2022 - Professora Ana Maria Nogales"
author: 
  - "Gabriel Peixoto Veiga^[Matrícula: 180016946]"
  - "João Victor Maia^[Matrícula: 221036824]"
  - "Marco Aurélio^[Matrícula: 160135702]"
  - "Rafael de Acypreste^[Matrícula: 200060023]"
date: "`r format(Sys.Date(),'%d/%m/%Y')`"
output:
  bookdown::html_document2:
    df_print: paged
    fig_caption: true
    number_sections: no
    theme: united
    toc: no
    toc_float:
      collapsed: yes
      smooth_scroll: yes
  bookdown::pdf_document2:  
    citation_package: natbib
    fig_caption: true
    number_sections: true
    toc_depth: 4
    latex_engine: xelatex
  bookdown::word_document2: default
fontsize: 12pt
linkcolor: blue
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{amsmath}
  - \usepackage{float}
  - \setlength{\parindent}{4em}
  - \setlength{\parskip}{1.5em}
  - \usepackage{titling}
  - \pretitle{\begin{center}
  - \posttitle{\end{center}}
bibliography: library_html.bib
biblio-style: "apalike"
link-citations: true
editor_options: 
  chunk_output_type: console
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(
  message = FALSE,
  warning = FALSE,
  echo    = FALSE,                 # Mostra os códigos automaticamente
  eval    = TRUE,                  # se quiser rodar o código R - colocar TRUE
  fig.cap = 'Elaboração própria.', # Legenda automática de figuras
  fig.pos = 'H'
)

```

```{r logo, echo=FALSE}
htmltools::img(src = knitr::image_uri(file.path(getwd(), "as_vert_cor.jpg")), 
               alt = 'logo', 
               style = 'position:absolute; top:18px; right:50px; padding:20px; height: 10em;')
```


# {#inic .tabset}


```{r}
if (!require("pacman")) install.packages("pacman")

if (!require("microdatasus")) {
  pacman::p_load("remotes")
  remotes::install_github("rfsaldanha/microdatasus")
}

pacman::p_load("microdatasus", ## Download dos dados de 2000 a 2020
               "tidyverse",    ## Pacote de utilidades para manipulação e visualização
               "kableExtra",   ## Elaboração das tabelas em LaTeX e html
               "lubridate",
               "readxl",
               "LexisPlotR",   ## Pacote para Diagramas de Lexix
               "data.table",  
               "scales",
               janitor,
               fdth)


options(scipen = 99)
```



## Parte 1: Estrutura Populacional e avaliação da informação sobre idade

> a)  Construa as pirâmides etárias por grupos de idade para a população da UF escolhida em 1991, 2000, 2010, 2015, 2020 e 2030. Comente os resultados à luz da discussão sobre transição demográfica.

Na resolução dessa questão, foram baixados, a partir do DATASUS, os dados específicos da população residente, em Pernambuco, para cada ano solicitado. Estes dados podem ser consultados em:

<http://tabnet.datasus.gov.br/cgi/deftohtm.exe?ibge/cnv/poppe.def>

A primeira pirâmide etária, referente ao ano censitário de 1991:

```{r, fig.cap='Fonte: IBGE.'}

pop91 <-
  read_xlsx(
    'pop91.xlsx'
  )

abs_virgula <- function (x) {
  format(
    abs(x),
    big.mark = ".",
    decimal.mark = ",",
    scientific = FALSE
  )
}


 
pop91 %>%
  mutate(sexo = factor(sexo, levels = c("Masculino", "Feminino"))) %>%
  pivot_wider(names_from  = `faixa etária`,
              values_from = pop) %>%
  mutate("0 a 4 anos" = `Menor 1 ano` + `1 a 4 anos`) %>%
  select(sexo, `0 a 4 anos`, `5 a 9 anos`:last_col()) %>%
  pivot_longer(cols = `0 a 4 anos`:last_col(),
               names_to = "faixa etária",
               values_to = "pop") %>%
  mutate('faixa etária' = factor(`faixa etária`, levels = c("0 a 4 anos", unique(
    pop91$`faixa etária`
  )))) %>%
  ggplot(mapping = aes(
    x = `faixa etária`,
    y = ifelse(sexo == "Feminino",  yes = pop, no = -pop),
    fill = sexo
  )) +
  geom_bar(stat = "identity") +
  scale_y_continuous(labels = abs_virgula, limits = (max(pop91$pop)) * c(-1, 1)) +
  labs(y = "População do estado de Pernambuco em 1991",
       x = "Faixa etária (em anos)",
       title = "Pirâmide etária do Estado de Pernambuco em 1991") +
  scale_fill_brewer(palette = "Set1", direction = 1) +
  theme(legend.position = "bottom") +
  coord_flip()
```

Segunda pirâmide etária, referente ao ano censitário de 2000:

```{r, fig.cap='Fonte: IBGE.'}
pop00 <-
  read_xlsx(
    'pop00.xlsx'
  )

abs_virgula <- function (x) {
  format(
    abs(x),
    big.mark = ".",
    decimal.mark = ",",
    scientific = FALSE
  )
}

pop00 %>%
  mutate(sexo = factor(sexo, levels = c("Masculino", "Feminino"))) %>%
  pivot_wider(names_from  = `faixa etária`,
              values_from = pop) %>% 
  mutate("0 a 4 anos" = `Menor 1 ano` + `1 a 4 anos`) %>% 
  select(sexo, `0 a 4 anos`, `5 a 9 anos`:last_col()) %>% 
  pivot_longer(cols = `0 a 4 anos`:last_col(),
               names_to = "faixa etária", 
               values_to = "pop") %>% 
  mutate('faixa etária' = factor(`faixa etária`, levels = c("0 a 4 anos", unique(pop91$`faixa etária`)))) %>% 
  ggplot(mapping = aes(
    x = `faixa etária`,
    y = ifelse(sexo == "Feminino",  yes = pop, no = -pop),
    fill = sexo
  )) +
  geom_bar(stat = "identity") +
  scale_y_continuous(labels = abs_virgula, limits = (max(pop00$pop)) * c(-1, 1)) +
  labs(y = "População do estado de Pernambuco em 2000", x = "Faixa etária (em anos)",
       title = "Pirâmide etária do Estado de Pernambuco em 2000") +
  scale_fill_brewer(palette = "Set1", direction = 1) +
  theme(legend.position = "bottom") +
  coord_flip()
```

Terceira pirâmide etária, referente ao ano censitário de 2010:

```{r, fig.cap='Fonte: IBGE.'}
pop10 <-
  read_xlsx(
    'pop10.xlsx'
  )

pop10 %>%
  mutate(sexo = factor(sexo, levels = c("Masculino", "Feminino"))) %>%
  pivot_wider(names_from  = `faixa etária`,
              values_from = pop) %>% 
  mutate("0 a 4 anos" = `Menor 1 ano` + `1 a 4 anos`) %>% 
  select(sexo, `0 a 4 anos`, `5 a 9 anos`:last_col()) %>% 
  pivot_longer(cols = `0 a 4 anos`:last_col(),
               names_to = "faixa etária", 
               values_to = "pop") %>% 
  mutate('faixa etária' = factor(`faixa etária`, levels = c("0 a 4 anos", unique(pop91$`faixa etária`)))) %>% 
  ggplot(mapping = aes(
    x = `faixa etária`,
    y = ifelse(sexo == "Feminino",  yes = pop, no = -pop),
    fill = sexo
  )) +
  geom_bar(stat = "identity") +
  scale_y_continuous(labels = abs_virgula, limits = (max(pop10$pop)) * c(-1, 1)) +
  labs(y = "População do estado de Pernambuco em 2000", x = "Faixa etária (em anos)",
       title = "Pirâmide etária do Estado de Pernambuco em 2010") +
  scale_fill_brewer(palette = "Set1", direction = 1) +
  theme(legend.position = "bottom") +
  coord_flip()
```

A construção das pirâmides dos anos de 2015, 2020 e 2030 se dá a partir dos dados disponíveis sobre a projeção populacional, também presentes no DATASUS.

Dados de 2015:

```{r , fig.cap='Fonte: IBGE.'}
pop15 <-
  read_xlsx(
    'pop15.xlsx'
  )

pop15 %>%
  mutate(sexo = factor(sexo, levels = c("Masculino", "Feminino")),
         'faixa etária' = factor(`faixa etária`, levels = unique(pop15$`faixa etária`))) %>%
  ggplot(mapping = aes(
    x = `faixa etária`,
    y = ifelse(sexo == "Feminino",  yes = pop, no = -pop),
    fill = sexo
  )) +
  geom_bar(stat = "identity") +
  scale_y_continuous(labels = abs_virgula, limits = (max(pop15$pop)) * c(-1, 1)) +
  labs(y = "População do estado de Pernambuco em 2015", x = "Faixa etária (em anos)",
       title = "Pirâmide etária do Estado de Pernambuco em 2015") +
  scale_fill_brewer(palette = "Set1", direction = 1) +
  theme(legend.position = "bottom") +
  coord_flip()
```

2020:

```{r, fig.cap='Fonte: IBGE.'}
pop20 <-
  read_xlsx(
    'pop20.xlsx'
  )

pop20 %>%
  mutate(sexo = factor(sexo, levels = c("Masculino", "Feminino")),
         'faixa etária' = factor(`faixa etária`, levels = unique(pop20$`faixa etária`))) %>%
  ggplot(mapping = aes(
    x = `faixa etária`,
    y = ifelse(sexo == "Feminino",  yes = pop, no = -pop),
    fill = sexo
  )) +
  geom_bar(stat = "identity") +
  scale_y_continuous(labels = abs_virgula, limits = (max(pop20$pop)) * c(-1, 1)) +
  labs(y = "População do estado de Pernambuco em 2020", x = "Faixa etária (em anos)",
       title = "Pirâmide etária do Estado de Pernambuco em 2020") +
  scale_fill_brewer(palette = "Set1", direction = 1) +
  theme(legend.position = "bottom") +
  coord_flip()
```

Para finalizar, a projeção populacional, do Estado de Pernambuco, para o ano de 2030:

```{r, fig.cap='Fonte: IBGE.'}
pop30 <-
  read_xlsx(
    'pop30.xlsx'
  )

pop30 %>%
  mutate(sexo = factor(sexo, levels = c("Masculino", "Feminino")),
         'faixa etária' = factor(`faixa etária`, levels = unique(pop30$`faixa etária`))) %>%
  ggplot(mapping = aes(
    x = `faixa etária`,
    y = ifelse(sexo == "Feminino",  yes = pop, no = -pop),
    fill = sexo
  )) +
  geom_bar(stat = "identity") +
  scale_y_continuous(labels = abs_virgula, limits = (max(pop30$pop)) * c(-1, 1)) +
  labs(y = "População projetada do estado de Pernambuco para 2030", x = "Faixa etária (em anos)",
       title = "Pirâmide etária do Estado de Pernambuco em 2030
       ") +
  scale_fill_brewer(palette = "Set1", direction = 1) +
  theme(legend.position = "bottom") +
  coord_flip()
```

A transição demográfica é um fenômeno e uma teoria que se refere à mudança histórica de taxas de natalidade e/ou mortalidade em sociedades com tecnologia mínima, educação (especialmente das mulheres) e desenvolvimento econômico, para baixas taxas de natalidade e baixas taxas de mortalidade nas sociedades com tecnologia avançada, educação e desenvolvimento econômico, bem como os estágios entre esses dois cenários.

No caso de Pernambuco, assim como também é válido para boa parte do Brasil, é notável uma mudança no perfil da população, em que, a cada censo ou projeção populacional, percebe-se um aumento da população idosa, ou seja, a estrutura etária da UF estudada seguiu um padrão de envelhecimento. Observa-se, neste passo, um aumento na expectativa de vida.

Também é possível notar que os índices de natalidade foram diminuindo conforme mostram os dados obtidos. Isso pode ser um reflexo de diferentes fatores, como uma maior inserção da mulher no mercado de trabalho, por exemplo.

> b)  Para todos os anos acima mencionados, calcule os indicadores de estrutura por idade (proporção de idosos (60 anos e mais), proporção de crianças (0 a 4 anos), proporção de jovens (0 a 14 anos), razão de dependência e índice de envelhecimento). Calcule a idade média e a idade mediana. Calcule e grafique a razão de sexo por grupos de idade para 2010 e 2030. Comente os resultados.

**Parte I)** Proporção populacional:


```{r}
totalpop <-
  pop91 %>%
  summarise(sum(pop)) # soma cada valor na coluna 'pop', resultando                       no total da população no ano censitário.
```

Proporção populacional para o ano censitário de **1991**:

```{r}
idosos91m <-
  pop91 %>%
  filter(sexo == 'Masculino') %>%
  tail(3) %>%
  summarise(sum(pop)) # soma da população idosa do sexo masculino
idosos91f <-
  pop91 %>%
  filter(sexo == 'Feminino') %>%
  tail(3) %>%
  summarise(sum(pop)) #soma da população idosa do sexo feminino

prop_idosos <- (idosos91m + idosos91f) / totalpop * 100  # proporção da pop. idosa em 1991

kids91m <-
  pop91 %>%
  filter(sexo == 'Masculino') %>%
  head(2) %>%
  summarise(sum(pop))
kids91f <-
  pop91 %>%
  filter(sexo == 'Feminino') %>%
  head(2) %>%
  summarise(sum(pop))

prop_kids <- (kids91m + kids91f) / totalpop * 100

jovens91m <-
  pop91 %>%
  filter(sexo == 'Masculino') %>%
  head(4) %>%
  summarise(sum(pop))
jovens91f <-
  pop91 %>%
  filter(sexo == 'Feminino') %>%
  head(4) %>%
  summarise(sum(pop))

prop_jovens <- (jovens91m + jovens91f) / totalpop * 100
```

A proporção da população idosa (60 anos ou mais) era de `r round(prop_idosos[1, 1], 2)` % em relação ao total da população. A população de crianças (0 a 4 anos), `r round(prop_kids[1, 1], 2)`%. Por fim, a proporção de jovens (0 a 14 anos) foi de `r round(prop_jovens[1, 1], 2)`%. 

Proporção populacional para o ano censitário de **2000**: 

```{r}
totalpop00 <-
  pop00 %>%
  summarise(sum(pop))

idosos00m <-
  pop00 %>%
  filter(sexo == 'Masculino') %>%
  tail(3) %>%
  summarise(sum(pop)) # soma da população idosa do sexo masculino
idosos00f <-
  pop00 %>%
  filter(sexo == 'Feminino') %>%
  tail(3) %>%
  summarise(sum(pop)) #soma da população idosa do sexo feminino

prop_idosos_2000 <- (idosos00m + idosos00f) / totalpop00 * 100 # proporção da pop. idosa em 1991

kids00m <-
  pop00 %>%
  filter(sexo == 'Masculino') %>%
  head(2) %>%
  summarise(sum(pop))
kids00f <-
  pop00 %>%
  filter(sexo == 'Feminino') %>%
  head(2) %>%
  summarise(sum(pop))

prop_kids_2000 <- (kids00m + kids00f) / totalpop00 * 100

jovens00m <-
  pop00 %>%
  filter(sexo == 'Masculino') %>%
  head(4) %>%
  summarise(sum(pop))
jovens00f <-
  pop00 %>%
  filter(sexo == 'Feminino') %>%
  head(4) %>%
  summarise(sum(pop))

prop_jovens_2000 <- (jovens00m + jovens00f) / totalpop00 * 100

```

No ano censitário de 2000, a população idosa (60 anos ou mais) correspondia a `r round(prop_idosos_2000[1, 1], 2)`0% do total, a população de crianças (0 a 4 anos), `r round(prop_kids_2000[1, 1], 2)`% e de jovens (0 a 14 anos), `r round(prop_jovens_2000[1, 1], 2)`%.

Proporção populacional para o ano censitário de **2010**:

```{r}
totalpop10 <-
  pop10 %>%
  summarise(sum(pop))

idosos10m <-
  pop10 %>%
  filter(sexo == 'Masculino') %>%
  tail(3) %>%
  summarise(sum(pop)) # soma da população idosa do sexo masculino
idosos10f <-
  pop10 %>%
  filter(sexo == 'Feminino') %>%
  tail(3) %>%
  summarise(sum(pop)) #soma da população idosa do sexo feminino

prop_idosos_2010 <- (idosos10m + idosos10f) / totalpop10 * 100 # proporção da pop. idosa em 1991

kids10m <-
  pop10 %>%
  filter(sexo == 'Masculino') %>%
  head(2) %>%
  summarise(sum(pop))
kids10f <-
  pop00 %>%
  filter(sexo == 'Feminino') %>%
  head(2) %>%
  summarise(sum(pop))

prop_kids_2010 <- (kids10m + kids10f) / totalpop10 * 100

jovens10m <-
  pop10 %>%
  filter(sexo == 'Masculino') %>%
  head(4) %>%
  summarise(sum(pop))
jovens10f <-
  pop10 %>%
  filter(sexo == 'Feminino') %>%
  head(4) %>%
  summarise(sum(pop))

prop_jovens_2010 <- (jovens10m + jovens10f) / totalpop10 * 100
```

No ano censitário de 2010, a população idosa (60 anos ou mais) correspondia a `r round(prop_idosos_2010[1, 1], 2)`% do total, a população de crianças (0 a 4 anos), `r round(prop_kids_2010[1, 1], 2)`% e de jovens (0 a 14 anos), `r round(prop_jovens_2010[1, 1], 2)`%.

Projeção da proporção populacional para o ano de **2015**:

```{r}
totalpop15 <-
  pop15 %>%
  summarise(sum(pop))

idosos15m <-
  pop15 %>%
  filter(sexo == 'Masculino') %>%
  tail(7) %>%
  summarise(sum(pop)) # soma da população idosa do sexo masculino
idosos15f <-
  pop15 %>%
  filter(sexo == 'Feminino') %>%
  tail(7) %>%
  summarise(sum(pop)) #soma da população idosa do sexo feminino

prop_idosos_2015 <- (idosos15m + idosos15f) / totalpop15 * 100 # proporção da pop. idosa em 1991

kids15m <-
  pop15 %>%
  filter(sexo == 'Masculino') %>%
  head(1) %>%
  summarise(sum(pop))
kids15f <-
  pop15 %>%
  filter(sexo == 'Feminino') %>%
  head(1) %>%
  summarise(sum(pop))

prop_kids_2015 <- (kids15m + kids15f) / totalpop15 * 100

jovens15m <-
  pop15 %>%
  filter(sexo == 'Masculino') %>%
  head(3) %>%
  summarise(sum(pop))
jovens15f <-
  pop15 %>%
  filter(sexo == 'Feminino') %>%
  head(3) %>%
  summarise(sum(pop))

prop_jovens_2015 <- (jovens15m + jovens15f) / totalpop15 * 100
```

Na projeção populacional do ano de 2015, a população idosa (60 anos ou mais) correspondia a `r round(prop_idosos_2015[1, 1], 2)`% do total, a população de crianças (0 a 4 anos), `r round(prop_kids_2015[1, 1], 2)`0% e de jovens (0 a 14 anos), `r round(prop_jovens_2015[1, 1], 2)`%.

Projeção da proporção populacional para o ano de **2020**:

```{r}
totalpop20 <-
  pop20 %>%
  summarise(sum(pop))

idosos20m <-
  pop20 %>%
  filter(sexo == 'Masculino') %>%
  tail(7) %>%
  summarise(sum(pop)) # soma da população idosa do sexo masculino
idosos20f <-
  pop20 %>%
  filter(sexo == 'Feminino') %>%
  tail(7) %>%
  summarise(sum(pop)) #soma da população idosa do sexo feminino

prop_idosos_2020 <- (idosos20m + idosos20f) / totalpop20 * 100 # proporção da pop. idosa em 1991

kids20m <-
  pop20 %>%
  filter(sexo == 'Masculino') %>%
  head(1) %>%
  summarise(sum(pop))
kids20f <-
  pop20 %>%
  filter(sexo == 'Feminino') %>%
  head(1) %>%
  summarise(sum(pop))

prop_kids_2020 <- (kids20m + kids20f) / totalpop20 * 100

jovens20m <-
  pop20 %>%
  filter(sexo == 'Masculino') %>%
  head(3) %>%
  summarise(sum(pop))
jovens20f <-
  pop20 %>%
  filter(sexo == 'Feminino') %>%
  head(3) %>%
  summarise(sum(pop))

prop_jovens_2020 <- (jovens20m + jovens20f) / totalpop20 * 100
```

Na projeção populacional do ano de 2020, a população idosa (60 anos ou mais) correspondia a `r round(prop_idosos_2020[1, 1], 2)`% do total, a população de crianças (0 a 4 anos), `r round(prop_kids_2020[1, 1], 2)`% e de jovens (0 a 14 anos), `r round(prop_jovens_2020[1, 1], 2)`%.

Projeção da proporção populacional para o ano de **2030**:

```{r}
totalpop30 <-
  pop30 %>%
  summarise(sum(pop))

idosos30m <-
  pop30 %>%
  filter(sexo == 'Masculino') %>%
  tail(7) %>%
  summarise(sum(pop)) # soma da população idosa do sexo masculino
idosos30f <-
  pop30 %>%
  filter(sexo == 'Feminino') %>%
  tail(7) %>%
  summarise(sum(pop)) #soma da população idosa do sexo feminino

prop_idosos_2030 <- (idosos30m + idosos30f) / totalpop30 * 100 # proporção da pop. idosa em 1991

kids30m <-
  pop30 %>%
  filter(sexo == 'Masculino') %>%
  head(1) %>%
  summarise(sum(pop))
kids30f <-
  pop30 %>%
  filter(sexo == 'Feminino') %>%
  head(1) %>%
  summarise(sum(pop))

prop_kids_2030 <- (kids30m + kids30f) / totalpop30 * 100

jovens30m <-
  pop30 %>%
  filter(sexo == 'Masculino') %>%
  head(3) %>%
  summarise(sum(pop))
jovens30f <-
  pop30 %>%
  filter(sexo == 'Feminino') %>%
  head(3) %>%
  summarise(sum(pop))

prop_jovens_2030 <- (jovens30m + jovens30f) / totalpop30 * 100
```

Na projeção populacional do ano de 2030, a população idosa (60 anos ou mais) correspondia a `r round(prop_idosos_2030[1, 1], 2)`% do total, a população de crianças (0 a 4 anos), `r round(prop_kids_2030[1, 1], 2)`% e de jovens (0 a 14 anos), `r round(prop_jovens_2030[1, 1], 2)`%.


**Parte 2)** Índice de Envelhecimento:

O índice de envelhecimento de uma população se defina pelo cálculo do peso da população idosa em relação à população considerada jovem (0 a 14 anos). 

A seguir, serão apresentadas os índices de envelhecimento para os anos censitários de 1991, 2000 e 2010, e as projeções de 2015, 2020 e 2030.

```{r}
indice_91 <- (idosos91f + idosos91m) / (jovens91f + jovens91m) * 100
indice_2000 <- (idosos00f + idosos00m) / (jovens00f + jovens00m) * 100
indice_2010 <- (idosos10f + idosos10m) / (jovens10f + jovens10m) * 100
indice_2015 <- (idosos15f + idosos15m) / (jovens15f + jovens15m) * 100
indice_2020 <- (idosos20f + idosos20m) / (jovens20f + jovens20m) * 100
indice_2030 <- (idosos30f + idosos30m) / (jovens30f + jovens30m) * 100

```

O índice de envelhecimento para os anos censitários de 1991, 2000 e 2010 foram de `r round(indice_91[1, 1], 2)`%, `r round(indice_2000[1, 1], 2)`% e `r round(indice_2010[1, 1], 2)`%, respectivamente.

Já para as projeções realizadas para 2015, 2020 e 2030, os índices de envelhecimento calculados foram de `r round(indice_2015[1, 1], 2)`%, `r round(indice_2020[1, 1], 2)`% e `r round(indice_2030[1, 1], 2)`%, respectivamente.

Observa-se que, a partir dos índices calculados, considerando a população idosa aquela pertencente à faixa etária que compreende 60+ anos de idade completos, existe uma tendência crescente do peso populacional dos idosos na UF estudada. 

**Parte 3)** Razão de Sexo por Grupos de Idade (2010 e 2030):

Para este cálculo, é necessário realizar a divisão simples entre o número de residentes, em um determinado período, para cada grupo de idade, da população masculina sobre a população feminina.

De acordo com o DATASUS, esta razão expressa a relação quantitativa entre os sexos. Se igual a 100, o número de homens e de mulheres se equivalem; acima de 100, há predominância de homens e, abaixo, predominância de mulheres. Informação que pode ser consultada neste [link](http://tabnet.datasus.gov.br/tabdata/LivroIDB/2edrev/a02.pdf).

```{r}
razao_kids_2010 <- (kids10m / kids10f) * 100
razao_jovens_2010 <- (jovens10m / jovens10f) * 100
razao_idosos_2010 <- (idosos10m / idosos10f) * 100
```

Para o ano censitário de 2010, foram observadas os seguintes índices: 

Para crianças (0 a 4 anos): `r round(razao_kids_2010[1, 1], 2)`.
Jovens (0 a 14 anos): `r round(razao_jovens_2010[1, 1], 2)`0.
Idosos: `r round(razao_idosos_2010[1, 1], 2)`.

```{r}
razao_kids_2030 <- (kids30m / kids30f) * 100
razao_jovens_2030 <- (jovens30m / jovens30f) * 100
razao_idosos_2030 <- (idosos30m / idosos30f) * 100
```

Na projeção para o ano de 2030, foram observados os seguintes índices: 

Para crianças (0 a 4 anos): `r round(razao_kids_2030[1, 1], 2)`.
Jovens (0 a 14 anos): `r round(razao_jovens_2030[1, 1], 2)`.
Idosos: `r round(razao_idosos_2030[1, 1], 2)`.





## Parte 2: Projeção de População

> **a)** *Os textos-base para responder a questão são @IBGE2021 e @IBGE2018 sobre as metodologias de estimação populacional.*

> *1) Metodologia utilizada para projetar a população do país segundo UF.*


Nota-se que o IBGE divulga desde 1973 as projeções populacionais pelo método das componentes principais. Além disso, desde 1975, divulga as projeções para Estados e Municípios durante os períodos intercensitários [@IBGE2018]. Ademais, sob qualquer sinal de de que estejam se distanciando do cenário real, as projeções devem ser revistas. Essas revisões também ocorrem após a realização de censos ou processos de contagem populacional.

As **projeções populacionais segundo a UF** em 2018 foram realizadas com o *software* do Departamento de Censo dos Estados Unidos (*Census Bureau*) denominado *US Census Bureau Rural and Urban Projection Program - RUP* [@IBGE2018].

O método utilizado foi o **método das componentes demográficas**. Para ser aplicado, é preciso partir de uma estrutura populacional já conhecida. Além disso, são necessárias informações confiáveis de fecundidade, mortalidade e migração. Com isso, são calculadas as interações entre essas três componentes seguindo as coortes ao longo do tempo. Avaliar tais interações é a parte mais delicada do processo, pois demanda acurácia nas projeções a respeito do futuro das taxas de fecundidade, mortalidade e migração de uma população [@IBGE2018]. 

Além de serem base para a formulação de diversas políticas públicas nos âmbitos naciona e regional, servem de base para estimar a população dos Municípios.



> *2) Metodologia para estimar populações dos municípios brasileiros.*

Como os munípios não apresentam as informações em nível de confiabilidade e detalhamento necessários para a aplicação do método das componentes demográficas, outra metodologia é necessária. O @IBGE2021 utiliza uma metodologia proposta por @madeira1972. 

Em síntese, observa-se a tendência de crescimento populacional do Município entre dois censos consecutivos. Em seguida, compara-se à tendência de crescimento de uma área geográfica hierarquicamente superior @IBGE2021 com dados de maior qualidade. Assim, essa área superior é dividida de modo que a soma das estimativas das suas sub-regiões iguale a projeção para a região base. Para o caso da estimativa 2021 para os Municípios, foram adotadas as projeções por UF referidas acima.


> **b)** *Assumindo população fechada (ausência de migração), projete a população da UF escolhida de 2010 a 2020, segundo o cenário de mortalidade e fecundidade do período 2010-2015 e 2015-2020. Considere os indicadores de mortalidade e fecundidade obtidos no Trabalho 1 e os publicados no portal do Datasus.*


A estimativa populacional partirá dos dados disponibilizados pelas projeções elaboradas pelo próprio IBGE e disponíveis [aqui](https://www.ibge.gov.br/estatisticas/sociais/populacao/9109-projecao-da-populacao.html?=&t=resultados). Trata-se da revisão de 2018, que utilizou os dados do Censo Demográfico de 2010 como base [@IBGE2018].

```{r}
  # Repositório do IBGE para a tabela .xls
file <-
  "https://ftp.ibge.gov.br/Projecao_da_Populacao/Projecao_da_Populacao_2018/projecoes_2018_populacao_2010_2060_20200406.xls"

  # Arquivo temporário para download da tabela
temp_pop <- tempfile()

  # Download da tabela em formato compatível com Windows
download.file(url      = file,
              destfile =  temp_pop,
              mode     = "wb")

  # Faixas etárias divulgadas pelo IBGE
faixas_etarias_IBGE <-
  read_xls(temp_pop,               # Arquivo temporário com a tabela de projeções
           sheet = "PE",           # Aba de Pernambuco
           range = "A7:A25",       # Células com a informação de interesse
           col_names = FALSE) %>%  # Sem nomes das colunas 
  pull()                           # Extrai as informações como um vetor

  # Lenvantamento da população masculina
pop_masc_2010 <-
  read_xls(temp_pop,
           sheet = "PE",
           range = "B7:B25",
           col_names = "Pop_masc") %>%
  pull()

  # Lenvantamento da população feminina
pop_fem_2010 <-
  read_xls(temp_pop,
           sheet = "PE",
           range = "B30:B48",
           col_names = "Pop_fem") %>%
  pull()

  # Lenvantamento da população total
pop_tot_2010 <-
  read_xls(temp_pop,
           sheet = "PE",
           range = "B53:B71",
           col_names = "Pop_tot") %>%
  pull()


pop_sex_ida_2010 <-
  tibble(
    "Idade_inicial" = faixas_etarias_IBGE,
    "Pop_masc_2010" = pop_masc_2010,
    "Pop_fem_2010"  = pop_fem_2010,
    "Pop_tot_2010"  = pop_tot_2010
  )

pop_sex_ida_2010_ajustada <- 
pop_sex_ida_2010 %>% 
  pivot_longer(cols = contains("Pop"),
               values_to = "Pop",
               names_to  = "Type") %>% 
  pivot_wider(names_from = Idade_inicial,
              values_from = Pop) %>% 
  rowwise() %>% # para somar nas linhas (caso contrário, resultado igual para todos)
  mutate("80+" = sum(c_across(`80-84`:`90+`))) %>% 
  select(-`80-84`, -`85-89`, -`90+`) %>% 
  pivot_longer(cols      = `0-4`:last_col(),
               names_to  = "Faixa_idade",
               values_to = "Pop") %>% 
  pivot_wider(names_from = Type,
              values_from = Pop)

 # Populações para comparar as projeções

  # Lenvantamento da população masculina
pop_masc_2015 <-
  read_xls(temp_pop,
           sheet = "PE",
           range = "G7:G25",
           col_names = "Pop_masc") %>%
  pull()

  # Lenvantamento da população feminina
pop_fem_2015 <-
  read_xls(temp_pop,
           sheet = "PE",
           range = "G30:G48",
           col_names = "Pop_fem") %>%
  pull()

pop_sex_ida_2015 <-
  tibble(
    "Idade_inicial" = faixas_etarias_IBGE,
    "Pop_masc_2015" = pop_masc_2015,
    "Pop_fem_2015"  = pop_fem_2015
  ) %>% 
  pivot_longer(cols = contains("Pop"),
               values_to = "Pop",
               names_to  = "Type") %>% 
  pivot_wider(names_from = Idade_inicial,
              values_from = Pop) %>% 
  rowwise() %>% # para somar nas linhas (caso contrário, resultado igual para todos)
  mutate("80+" = sum(c_across(`80-84`:`90+`))) %>% 
  select(-`80-84`, -`85-89`, -`90+`) %>% 
  pivot_longer(cols      = `0-4`:last_col(),
               names_to  = "Faixa_idade",
               values_to = "Pop") %>% 
  pivot_wider(names_from = Type,
              values_from = Pop)

  # Lenvantamento da população masculina
pop_masc_2020 <-
  read_xls(temp_pop,
           sheet = "PE",
           range = "L7:L25",
           col_names = "Pop_masc") %>%
  pull()

  # Lenvantamento da população masculina
pop_fem_2020 <-
  read_xls(temp_pop,
           sheet = "PE",
           range = "L30:L48",
           col_names = "Pop_fem") %>%
  pull()


pop_sex_ida_2020 <-
  tibble(
    "Idade_inicial" = faixas_etarias_IBGE,
    "Pop_masc_2020" = pop_masc_2020,
    "Pop_fem_2020"  = pop_fem_2020
  ) %>% 
  pivot_longer(cols = contains("Pop"),
               values_to = "Pop",
               names_to  = "Type") %>% 
  pivot_wider(names_from = Idade_inicial,
              values_from = Pop) %>% 
  rowwise() %>% # para somar nas linhas (caso contrário, resultado igual para todos)
  mutate("80+" = sum(c_across(`80-84`:`90+`))) %>% 
  select(-`80-84`, -`85-89`, -`90+`) %>% 
  pivot_longer(cols      = `0-4`:last_col(),
               names_to  = "Faixa_idade",
               values_to = "Pop") %>% 
  pivot_wider(names_from = Type,
              values_from = Pop)

```


Para o primeiro período de 2010 e 2015, utilizou-se a tábua de vida de 2013 elaborada pelo próprio IBGE e disponível [aqui](https://www.ibge.gov.br/estatisticas/sociais/populacao/9109-projecao-da-populacao.html?=&t=resultados). Já para a projeção da população sobrevivente entre 2015 e 2020, foram utilizados os dados do [trabalho 1](https://rpubs.com/rafaeldeacypreste/analise-demografica-pernambuco).


```{r}
  # 1) Tábua de vida IBGE

  # Repositório do IBGE para a tabela .xls
file <-
  "https://ftp.ibge.gov.br/Projecao_da_Populacao/Projecao_da_Populacao_2018/Tabuas_Mortalidade%202010-2060.xls"

  # Arquivo temporário para download da tabela
temp_tabua_vida <- tempfile()

  # Download da tabela em formato compatível com Windows
download.file(url      = file,
              destfile = temp_tabua_vida,
              mode     = "wb")

tabua_IBGE_masc <-  
read_xls(temp_tabua_vida,         # Arquivo temporário com a tabela de projeções
         sheet = "PE",            # Aba de Pernambuco
         range = "A84:I105") %>%  # Células com a informação de interesse) %>%
         drop_na() %>%
           select(Idade, nLx) %>% 
           pivot_wider(names_from  = Idade,
                       values_from = nLx) %>% 
           mutate(
             "75+" = sum(c_across(`75`:`90+`)),
             "80+" = sum(c_across(`80`:`90+`)),
             "0"   = sum(c_across(`0`:`1`))
           ) %>%
           select(-`1`, -`80`,-`85`,-`90+`) %>% 
           pivot_longer(cols      = `0`:last_col(),
                        names_to  = "Idade",
                        values_to = "nLx") %>% 
  mutate(prop_sobrev_IBGE_masc = nLx / lag(nLx, default = 500000)) %>% 
  filter(Idade != "75+")
         


tabua_IBGE_fem <-   
read_xls(temp_tabua_vida,         # Arquivo temporário com a tabela de projeções
         sheet = "PE",            # Aba de Pernambuco
         range = "K84:S105") %>%  # Células com a informação de interesse) %>%
         drop_na() %>%
           select(Idade, nLx) %>% 
           pivot_wider(names_from  = Idade,
                       values_from = nLx) %>% 
           mutate(
             "75+" = sum(c_across(`75`:`90+`)),
             "80+" = sum(c_across(`80`:`90+`)),
             "0"   = sum(c_across(`0`:`1`))
           ) %>%
           select(-`1`, -`80`,-`85`,-`90+`) %>% 
           pivot_longer(cols      = `0`:last_col(),
                        names_to  = "Idade",
                        values_to = "nLx") %>% 
  mutate(prop_sobrev_IBGE_fem = nLx / lag(nLx, default = 500000)) %>% 
  filter(Idade != "75+")


#----------------------------------------------------------------------

  # 2) Tábua de vida trabalho 1

tabua_trab1_masc <- 
read_xlsx("TabuasVida.xlsx", 
          sheet = "TV Masc", 
          range = "A1:H19") %>%
  select(x, nLx) %>%
  pivot_wider(names_from  = x,
              values_from = nLx) %>% 
  rename("80+" = `80`) %>% 
  mutate(
    "0"   = sum(c_across(`0`:`1`)),
    "75+" = sum(c_across(`75`:`80+`))) %>%  
  select(-`1`) %>% 
  select(`0`:`75`, `75+`, `80+`) %>% 
  pivot_longer(cols      = `0`:last_col(),
               names_to  = "Idade",
               values_to = "nLx") %>% 
  mutate(prop_sobrev_trab1_masc = nLx / lag(nLx, default = 500000)) %>% 
  filter(Idade != "75+")

  # Tábua feminina
tabua_trab1_fem <- 
read_xlsx("TabuasVida.xlsx", 
          sheet = "TV Fem", 
          range = "A1:H19") %>%
  select(x, nLx) %>%
  pivot_wider(names_from  = x,
              values_from = nLx) %>% 
  rename("80+" = `80`) %>% 
  mutate(
    "0"   = sum(c_across(`0`:`1`)),
    "75+" = sum(c_across(`75`:`80+`))) %>%  
  select(-`1`) %>% 
  select(`0`:`75`, `75+`, `80+`) %>% 
  pivot_longer(cols      = `0`:last_col(),
               names_to  = "Idade",
               values_to = "nLx") %>% 
  mutate(prop_sobrev_trab1_fem = nLx / lag(nLx, default = 500000)) %>% 
  filter(Idade != "75+")


```

Para os nascimentos, foram utilizadas as taxas específicas de fecundidade feminina com base nos dados do trabalho 1. Para o período de 2010 a 2015, utilizou-se as taxas calculadas conforme a média de nascimentos entre 2010 e 2015 com população feminina de referência em 2013 projetada pelo @IBGE2018.

Para a projeção 2015-2020, utilizou-se as taxas calculadas de acordo com a média de nascimentos entre 2016 a 2020, com população feminina de 2018 projetada pelo @IBGE2018. 

```{r}
  # População feminina em idade fértil em 2015
pop_fem_2013 <- 
  read_xls(temp_pop,
           sheet     = "PE",
           range     = "E30:E48",
           col_names = "Pop_fem") %>%
  pull()

pop_fem_2013_fertil <- 
  tibble(
    "Idade_inicial" = faixas_etarias_IBGE,
    "Pop_fem_2013"  = pop_fem_2013) %>% 
    filter(between(Idade_inicial, "10-14", "45-49"))


  # População feminina em idade fértil em 2020
pop_fem_2018 <- 
  read_xls(temp_pop,
           sheet = "PE",
           range = "J30:J48",
           col_names = "Pop_fem") %>%
  pull()

pop_fem_2018_fertil <- 
  tibble(
    "Idade_inicial" = faixas_etarias_IBGE,
    "Pop_fem_2018" = pop_fem_2018) %>% 
    filter(between(Idade_inicial, "10-14", "45-49"))
```


```{r, cache=TRUE}
 # Nascimentos vivos
  # Download dos microdados do datasus
dados_sinasc <- fetch_datasus(
  year_start         = 2000,
  year_end           = 2020,
  uf                 = "PE",
  information_system = "SINASC"
)

```


```{r, cache=TRUE, results='hide'}
  # Repositório Ministério da Saúde
file <- "https://svs.aids.gov.br/dantps/centrais-de-conteudos/dados-abertos/sinasc/DN21OPEN.zip"
  
  # Cria arquivo temporário para download do arquivo .zip
temp <- tempfile()
  
  # Download do arquivo
utils::download.file(file, temp, mode = "wb")


  # Cria pasta temporária para descompactar arquivo .zip
tempd <- tempdir()
  
  # Descompacta o arquivo
unzip(temp, exdir = tempd)


dados_sinasc_2021 <- foreign::read.dbf(str_c(tempd, "\\DNOPEN21.dbf")) %>%                 # Importa a tabela .dbf
  filter(str_detect(CODMUNRES, "^26")) # Filtra pessoas residentes apenas em PE

  # Remove arquivo e pasta temporárias
file.remove(temp)
unlink(tempd)

```


```{r}


# 2014 a 2016

  # Nascidos vivos por idade da mãe
nascidos_vivos_ate_2016 <- 
dados_sinasc %>%
  select(DTNASC, IDADEMAE) %>% # Seleciona as colunas de interesse
  mutate(# Transforma Data de óbito em .date
    DTNASC = str_sub(DTNASC,-4,-1)) %>% # Identifica o ano do nascimento
  filter(DTNASC %in% 2010:2015) %>% 
  mutate(IDADEMAE = as.numeric(IDADEMAE)) %>%
  group_by(DTNASC) %>%
  filter(between(IDADEMAE, 10, 49)) %>% # Menos que 10 anos deve ser erro de registro
  mutate(
    Faixa_etaria = cut(      # Divisão das faixas etárias
      IDADEMAE,              # Agrupa nas faixas
      breaks         = c(10, seq(
        from = 20, to = 50, by = 5 # 1o intervalo de 10 a 20
      )),                    # Períodos de quebra
      right          = FALSE,
      include.lowest = TRUE,
      labels         = faixas_etarias_IBGE[4:10]   # Nomes dos intervalos etários
    )
  ) %>% 
  arrange(IDADEMAE) %>% 
  count(DTNASC, Faixa_etaria) %>%
  group_by(Faixa_etaria) %>%
  summarise(Nascimentos = round(mean(n)))

  # Tábua específica de fertilidade
nfx_2015 <- 
  nascidos_vivos_ate_2016 %>%
  left_join(pop_fem_2013_fertil, by = c("Faixa_etaria" = "Idade_inicial")) %>%
  mutate(nfx = Nascimentos / Pop_fem_2013) %>% 
  select("Faixa_idade" = Faixa_etaria, nfx)

#---------------------------------------------------------------
# 2019 a 2021

  # Nascidos vivos por idade da mãe
nascidos_vivos_ate_2020 <- 
dados_sinasc %>%
  select(DTNASC, IDADEMAE) %>% # Seleciona as colunas de interesse
  mutate(# Transforma Data de óbito em .date
    DTNASC = str_sub(DTNASC,-4,-1)) %>% # Identifica o ano do nascimento
  filter(DTNASC %in% 2016:2020)



nascidos_vivos_ate_2021 <-  
  nascidos_vivos_ate_2020 %>%
  mutate(IDADEMAE = as.numeric(IDADEMAE)) %>%
  group_by(DTNASC) %>%
  filter(between(IDADEMAE, 10, 49)) %>% # Menos que 10 anos deve ser erro de registro
  mutate(
    Faixa_etaria = cut(      # Divisão das faixas etárias
      IDADEMAE,              # Agrupa nas faixas
      breaks         = c(10, seq(
        from = 20, to = 50, by = 5
      )),                    # Períodos de quebra
      right          = FALSE,
      include.lowest = TRUE,
      labels         = faixas_etarias_IBGE[4:10]                                # Nomes dos intervalos etários
    )
  ) %>% 
  arrange(desc(IDADEMAE)) %>%
  count(DTNASC, Faixa_etaria) %>%
  group_by(Faixa_etaria) %>%
  summarise(Nascimentos = round(mean(n)))

nfx_2020 <-
  nascidos_vivos_ate_2021 %>%
  left_join(pop_fem_2018_fertil, by = c("Faixa_etaria" = "Idade_inicial")) %>%
  mutate(nfx = Nascimentos / Pop_fem_2018) %>% 
  select("Faixa_idade" = Faixa_etaria, nfx)

```



> Projeção da população para 2015 e para 2020

A partir das condições apresentadas, as projeções de população para os anos de 2015 e 2020 no Estado de Pernambuco são: 

```{r}
projecao_2015 <- 
pop_sex_ida_2010_ajustada %>% 
  bind_cols(select(tabua_IBGE_masc, prop_sobrev_IBGE_masc)) %>% 
  bind_cols(select(tabua_IBGE_fem, prop_sobrev_IBGE_fem)) %>% 
  mutate(Projecao_2015_masc = round(Pop_masc_2010 * prop_sobrev_IBGE_masc),
         Projecao_2015_fem = round(Pop_fem_2010 * prop_sobrev_IBGE_fem)) %>% 
  select(Faixa_idade, contains("Projecao")) %>% 
  pivot_longer(cols      = contains("Projecao"),
               values_to = "L_valor",
               names_to  = "Type") %>% 
  pivot_wider(names_from  = Faixa_idade,
              values_from = L_valor) %>% 
  mutate("75-79" = `75-79` + `80+`)  %>% 
  pivot_longer(cols      = `0-4`:last_col(),
                        names_to  = "Faixa_idade",
                        values_to = "Valor") %>%
           pivot_wider(names_from  = Type,
                       values_from = Valor)  %>% 
  mutate(Projecao_2015_masc = lag(Projecao_2015_masc),
         Projecao_2015_fem  = lag(Projecao_2015_fem)) 

  # Nascimentos no período
faixa_0_4_2015 <- 
pop_sex_ida_2010_ajustada %>% 
  left_join(nfx_2015) %>% 
  mutate(Nascimentos = Pop_fem_2010 * nfx) %>% 
  summarise(Nascimentos = 5 * round(sum(Nascimentos, na.rm = TRUE))) %>% 
  pull()

  # Inclui a razão de sexo
projecao_2015[1, "Projecao_2015_masc"] <- round(faixa_0_4_2015 * 105/205)
projecao_2015[1, "Projecao_2015_fem"] <- round(faixa_0_4_2015 * 100/205)


#----------------------------------------------------------

# Projeção 2020

projecao_2020 <- 
projecao_2015 %>% 
  bind_cols(select(tabua_trab1_masc, prop_sobrev_trab1_masc)) %>% 
  bind_cols(select(tabua_trab1_fem, prop_sobrev_trab1_fem)) %>% 
  mutate(Projecao_2020_masc = round(Projecao_2015_masc * prop_sobrev_trab1_masc),
         Projecao_2020_fem = round(Projecao_2015_fem * prop_sobrev_trab1_fem)) %>% 
  select(Faixa_idade, contains("Projecao_2020")) %>%   
  pivot_longer(cols      = contains("Projecao"),
               values_to = "L_valor",
               names_to  = "Type") %>% 
  pivot_wider(names_from  = Faixa_idade,
              values_from = L_valor) %>% 
  mutate("75-79" = `75-79` + `80+`)  %>% 
  pivot_longer(cols      = `0-4`:last_col(),
                        names_to  = "Faixa_idade",
                        values_to = "Valor") %>%
           pivot_wider(names_from  = Type,
                       values_from = Valor)  %>% 
  mutate(Projecao_2020_masc = lag(Projecao_2020_masc),
         Projecao_2020_fem  = lag(Projecao_2020_fem)) 

faixa_0_4_2020 <- 
projecao_2015 %>% 
  left_join(nfx_2020) %>% 
  mutate(Nascimentos = Projecao_2015_fem * nfx) %>% 
  summarise(Nascimentos = 5 * round(sum(Nascimentos, na.rm = TRUE))) %>% 
  pull()

  # Inclui a razão de sexo
projecao_2020[1, "Projecao_2020_masc"] <- round(faixa_0_4_2020 * 105/205)
projecao_2020[1, "Projecao_2020_fem"] <- round(faixa_0_4_2020 * 100/205)

projecoes <- 
pop_sex_ida_2010_ajustada %>%
  select(-Pop_tot_2010) %>%
  left_join(projecao_2015) %>%
  left_join(projecao_2020) %>%
  select(Faixa_idade, contains("fem"), everything()) 


  # Tabela para .html
projecoes %>% 
  adorn_totals() %>% 
  kbl(
    format    = "html",
    align     = "c",
    digits    = 0,
    booktabs  = TRUE,
    col.names = c(
      "Faixa Etária",
      "População Feminina 2010",
      "População Feminina 2015 (projeção)",
      "População Feminina 2020 (projeção)",
      "População Masculina 2010",
      "População Masculina 2015 (projeção)",
      "População Masculina 2020 (projeção)"
    ),
    format.args = list(big.mark = ".", decimal.mark = ","),
    caption     = "Projeções populacionais para o Estado de Pernambuco por sexos em 2015 e 2020" 
  ) %>%
  footnote(
    general  = "Projeção populacional para o ano de 2010 (revisão 2018) e Tábua de vida elaboradas pelo do @IBGE2018. Dados do  Ministério da Saúde, Sistema de Informação sobre Nascidos Vivos (MS/Sinasc) para o cálculo das taxas específicas de fecundidade. ",
    general_title = "Fontes: ",
    footnote_as_chunk = TRUE,
    threeparttable    = TRUE
  ) %>%
  kable_styling("striped")
```



> **c)** No link https://www.ibge.gov.br/estatisticas/sociais/populacao/9109-projecao-da-populacao.html?=&t=downloads estão disponíveis as projeções da população por sexo e idade para o Brasil (2010-2060) e para as Unidades da Federação - revisão 2018, realizadas pelo IBGE.

> 1.  Com base nessas informações, construa e compare as pirâmides resultantes para os anos de 2010, 2020 e 2060 para o Brasil.

Por meio das Pirâmides Etárias, percebe-se a distribuição da popolução brasileira nos anos 2010 (figura \@ref(fig:piramide-br-2010)), 2020 (\@ref(fig:piramide-br-2020)) e a projeção para o ano 2060 (figura \@ref(fig:piramide-br-2060)). Na primeira transição, percebe-se diminuição da mortalidade e aumento da idade média. Na transição entre 2020 e 2060, percebe-se diminuição da mortalidade, diminuição da fecundidade e estabilização da população, com aumento da taxa de dependência.


```{r piramide-br-2010, out.width = '100%', fig.cap='Fonte: projeçoes do IBGE.'}
knitr::include_graphics(file.path(getwd(), "piramide-br-2010.jpeg"))
```

```{r piramide-br-2020, out.width = '100%', fig.cap='Fonte: projeçoes do IBGE.'}
knitr::include_graphics(file.path(getwd(), "piramide-br-2020.jpeg"))
```

```{r piramide-br-2060, out.width = '100%', fig.cap='Fonte: projeçoes do IBGE.'}
knitr::include_graphics(file.path(getwd(), "piramide-br-2060.jpeg"))
```

As pirâmides em vermelho representam a distribuição etária de Pernambuco também nos anos 2010 (figura \@ref(fig:piramide-pe-2010)), 2020 (figura \@ref(fig:piramide-pe-2020)) e 2060 (figura \@ref(fig:piramide-pe-2060)). Percebe-se que os movimentos de transição se repetem, sendo inclusive mais perceptível quando se analisa apenas uma UF separada do total nacional.


```{r piramide-pe-2010, out.width = '100%', fig.cap='Fonte: projeçoes do IBGE.'}
knitr::include_graphics(file.path(getwd(), "piramide-pe-2010.jpeg"))
```

```{r piramide-pe-2020, out.width = '100%', fig.cap='Fonte: projeçoes do IBGE.'}
knitr::include_graphics(file.path(getwd(), "piramide-pe-2020.jpeg"))
```

```{r piramide-pe-2060, out.width = '100%', fig.cap='Fonte: projeçoes do IBGE.'}
knitr::include_graphics(file.path(getwd(), "piramide-pe-2060.jpeg"))
```

> 2. Compare os resultados da projeção para a UF escolhida realizada no item (b) e a publicada pelo IBGE

Agora, pode-se comparar os dados das projeções populacionais consolidados acima com as projeções oficiais do IBGE, disponíveis [aqui](https://www.ibge.gov.br/estatisticas/sociais/populacao/9109-projecao-da-populacao.html?=&t=downloads).

A comparação para o ano de 2015 está na tabela \@ref(tab:comparacao-2015). As projeções do total das populações feminina e masculina ficaram próximas à realizada pelo @IBGE2018. Esse resultado, entretanto, envolveu uma subestimação dos valores de nascimentos e uma sobre-estimação das populações das faixas etárias acima dos 70 anos.

```{r comparacao-2015}
comparacao_2015 <- 
projecoes %>% 
  select(Faixa_idade, contains("2015")) %>% 
  left_join(pop_sex_ida_2015) %>% 
  select(Faixa_idade, contains("fem"), contains("masc")) %>% 
  adorn_totals()

comparacao_2015 %>% 
    kbl(
    format    = "html",
    align     = "c",
    digits    = 0,
    booktabs  = TRUE,
    col.names = c(
      "Faixa Etária",
      "População Feminina 2015 (projeção)",
      "População Feminina 2015 (IBGE)",
      "População Masculina 2015 (projeção)",
      "População Masculina 2020 (IBGE)"
    ),
    format.args = list(big.mark = ".", decimal.mark = ","),
    caption     = "Comparação entre as projeções próprias e as realizadas pelo IBGE para o ano de 2015" 
  ) %>%
  footnote(
    general  = "Projeção populacional para o ano de 2015 (revisão 2018) do @IBGE2018.",
    general_title = "Fontes: ",
    footnote_as_chunk = TRUE,
    threeparttable    = TRUE
  ) %>%
  kable_styling("striped")

```

A comparação para o ano de 2015 está na tabela \@ref(tab:comparacao-2020). Semelhantemente à projeção para 2015, as projeções do total das populações feminina e masculina ficaram próximas à realizada pelo @IBGE2018. Esse resultado, novamente, envolveu uma subestimação dos valores de nascimentos e uma sobre-estimação das populações das faixas etárias acima dos 70 anos.

```{r comparacao-2020}
comparacao_2020 <- 
projecoes %>% 
  select(Faixa_idade, contains("2020")) %>% 
  left_join(pop_sex_ida_2020) %>% 
  select(Faixa_idade, contains("fem"), contains("masc")) %>% 
  adorn_totals()

comparacao_2020 %>% 
    kbl(
    format    = "html",
    align     = "c",
    digits    = 0,
    booktabs  = TRUE,
    col.names = c(
      "Faixa Etária",
      "População Feminina 2020 (projeção)",
      "População Feminina 2020 (IBGE)",
      "População Masculina 2020 (projeção)",
      "População Masculina 2020 (IBGE)"
    ),
    format.args = list(big.mark = ".", decimal.mark = ","),
    caption     = "Comparação entre as projeções próprias e as realizadas pelo IBGE para o ano de 2020" 
  ) %>%
  footnote(
    general  = "Projeção populacional para o ano de 2020 (revisão 2018) do @IBGE2018.",
    general_title = "Fontes: ",
    footnote_as_chunk = TRUE,
    threeparttable    = TRUE
  ) %>%
  kable_styling("striped")
```



### Referências